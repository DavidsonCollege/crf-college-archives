<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open Davidson</title>
  <link href="https://fonts.googleapis.com/css2?family=Quattrocento&display=swap" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <!-- Include jQuery -->
</head>


<body>
  <!-- NAVIGATION BAR -->
<nav class="navbar navbar-expand-lg navbar-custom">
    <a class="navbar-brand" href="#" id="archive-search-icon">
      <img src="{{ url_for('static', filename='assets/Open.png') }}" width="50" height="50" class="d-inline-block align-top" alt="Logo">
      <span class="open-davidson">Open Davidson</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#" id="home-link">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="advanced-search-link">Advanced Search</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="aboutDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              About
          </a>
          <div class="dropdown-menu" aria-labelledby="aboutDropdown">
              <a class="dropdown-item" href="#" id="about-link">About the Project</a>
              <a class="dropdown-item" href="#" id="team-link">Our Team</a>
              <a class="dropdown-item" href="#" id="instructions-link">Instructions</a>
          </div>
      </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="cv-link">Controlled Vocabulary</a>
        </li>
      </ul>
    </div>
</nav>
  <!-- HOME CONTENT -->
  <div id="home-content" class="tab-content">
    <h3><strong>Welcome to Open Davidson</strong></h3>
    <div id="search-bar">
      <p>Open Davidson provides keyword searching of all The Davidsonian issues published between 1914-2010. 
        These operators can be used between search terms: <strong>AND</strong> (default),
         <strong>OR</strong>, <strong>NOT</strong>, <strong>NEAR</strong>. These operators 
        must be capitalized to be used properly. For information on advanced search operators available in this tool, 
        see the <a href="#" id="go-to-instructions">Instructions</a> section listing all available search operators</p>
        <p><em>We highly recommend that while conducting your research with this tool, you look at the original documents 
          for official reference. Although we are very confident in the accuracy and readability of our text files, 
          they may contain a small percentage of errors. Therefore, when citing or drawing important conclusions, 
          look through the OCR’d PDF by clicking the “View Page” link and visit the original source in the Davidson 
          College library by clicking “View Issue.” To learn more about how these text files were generated and how 
          errors were corrected, please refer to the "About the Project" page.</em></p>
        <p><em>"Some of the terminology used is reflective of the language used historically by members of the Davidson community. 
            These terms may be, but are not necessarily, outdated, offensive, and/or harmful. While we would not use this 
            terminology today, it is important to search for these terms in historical documents to surface valuable information 
            for researchers today." (Davidson College Archives, 2024)</em></p>
          <h5>Wondering Where to Start?</h5><p>For a list of commonly searched terms to help your research, click <a href="#" id="go-to-cv">here.</a></p>
      <div class="input-group mb-3">
        <input type="text" class="form-control" id="search-input" placeholder="Enter keyword" aria-label="Enter keyword" aria-describedby="basic-addon2">
        <div class="input-group-append">
            <button class="btn btn-maroon" type="button" onclick="performSearch()">Search</button>
        </div>
    </div>
    <p>For more advanced search functionality, please visit the <a href="#" id="go-to-advanced-search">advanced search tab.</a></p>
  </div>
  <div id="search-results"></div>
</div>
<!-- ADVANCED SEARCH CONTENT -->
  <div id="advanced-search-content" class="tab-content" style="display:none;">
  <h3><srtong>Advanced Search</srtong></h3>
  <p>This search function grants you more ability to filter and contextualize your search. 
    Use the <strong>"Date From"</strong> and <strong>"Date To"</strong> inputs to specificy what 
    time period you want your results to include. Further, you may input the amount 
    of <strong>"Context Lines"</strong> you want to reveal around your keyword. 
    Higher context line inputs will reveal more of the surrounding text for any given search.</p>
  <form id="advanced-search-form">
      <div class="form-group">
          <label for="keyword">Keyword</label>
          <input type="text" class="form-control" id="keyword" name="keyword" placeholder="Enter keyword">
      </div>
      <div class="form-group">
        <label for="date-from">Date From</label>
        <input type="text" class="form-control" id="date-from" name="date-from" placeholder="MM/DD/YYYY or YYYY">
    </div>
    <div class="form-group">
        <label for="date-to">Date To</label>
        <input type="text" class="form-control" id="date-to" name="date-to" placeholder="MM/DD/YYYY or YYYY">
    </div>
      <div class="form-group">
          <label for="context">Context Lines</label>
          <input type="number" class="form-control" id="context-lines" >
      </div>
      <button type="button" class="btn btn-maroon" onclick="performAdvancedSearch()">Search</button>
  </form>
  <div id="advanced-search-results"></div>
</div>
  <!--INSTRUCTIONS CONTENT-->
  <div id="instructions-content" class="tab-content">

    <h3>How to Use our Tool</h3>
    <p><strong>Video:</strong></p>
    <ul>
      <p><li>When looking at the home page, at the top you will see the search bar. <strong>If you don’t know 
        what to search</strong>, look under the <em>“Controlled Vocabulary”</em> section. You will see a bulleted 
        list from the Davidson College Archives. Click on a name or term, and search results will appear automatically.</li></p>
      <p><li>If you are not using the Controlled Vocabulary list, type your term or name into the search bar and click 
        the “Search” button. You can use various search operators to refine your search. These operators are explained 
        below. For more inforamtion, view our <a href="static/assets/Search_Operators.png" class="image-link">table on search operators.</a></p></li>
            <ul>
              <li><strong>AND</strong> (default): This will produce search results that include every 
                scan in which the operated terms both appear in. </li>
              <li><strong>OR</strong>: This will produce search results that include all scans with either 
                search term</li>
              <li><strong>NOT</strong>: This will produce search results that include all scans with only 
                the first search term</li>
              <li><strong>NEAR</strong>: The NEAR operator finds general proximity. For more specific 
                proximity you can use the syntax <em>“Word1 Word2”~n</em></li>
              <li><strong>" "</strong>: This operator is used for searching exact phrases.</li>
              <li><strong> ~ </strong>: Adding this operator to the end of your keyword will produce search 
                results that are a close match to your query. For example using the query <em>Davidson~</em> 
                will provide search results with all documents containing a term with that match Davidson, 
                and have at most a one character difference. </li>
                <ul>
                  <li>You can specify prefixes to maintain in these “fuzzy” searches. For example, to search 
                    for all results that match the first 5 characters of Davidson, but have at most two 
                    different character in the remaining letters, your query would be <em>Davidson~2/3</em></li>
                </ul>
                <li><strong> ? </strong>: This operator is used to specify which character can be changed 
                  in your search results. 
                <li><strong> ^n </strong>: This operator is used to give more weight to one word in a 
                  multi-word search. This will impact the ordering of your results when sorting by relevance. 
                  To search Davidson Wildcats, with Davidson holding double the weight that Wildcats does, 
                  you would search <em>Davidson^2 Wildcats^0.5</em>.</li>
                </ul>
              <li>For further reference on the capabilities of our search, please refer to the 
                  Whoosh query language <a href="https://whoosh.readthedocs.io/en/latest/querylang.html#">documentation. </a>
                  This page details further examples of the search operators listed above.</li>
              </li></p>
        <p><li>For a more advanced search, click on the “Advanced Search” tab at the top of the page.</li>
          <ul>
            <li>On this page, you can filter for a specific time frame in the <em>“Date From”</em> 
              and <em>“Date to.”</em> You can input your dates as years (YYYY) or DD/MM/YYYY.</li>
            <li>Under that, you can specify how many context lines will be shown around your keyword. 
              Context lines refer to the amount of lines displayed in your text output on either side 
              of the search query. For reference, the default context lines value is 3.</li>
            <li>Once you have completed the Keyword, Date From and To, and Context line boxes, 
              click “Search” or press Enter.</li>
          </ul>
       </p>
        <p><li>Once you have your search results, you will see various issues and pages of 
          the Davidsonian as a list. To view the context lines, click on the date and page number.</li>
          <ul>
          <li>To adjust how you see your results, look at the gray buttons to the right of the search button.</li>
          <ul>
            <li>The “Sort By Date” button will organize your results from oldest at the top to 
              newest at the bottom.</li>
            <li>The “Sort by Relevance” button will put the most relevant results at the top of the 
              page. Relevance is calculated using the number of times the keyword is shown on the page. 
              For instance, a page with a keywordon it 10 times is more relevant than a page with a 
              keyword on it 2 times.</li>
          </ul>
          <li>Next to the Issue’s date and page number you will see “View Page” and “View Issue.”</li>
          <ul>
            <li>To see the specific page where your keyword was found, Click “View Page” once you find the 
              Davidsonian page you want to explore. This button will bring you to a searchable pdf, where 
              you can use the Ctrl+F function to see your keyword</li>
            <li>To explore the entire issue where your keyword was found, click “View Issue.” This will 
              take you to the library website for the issue you want to explore.</li>
          </ul>
          <li>If you want to save your search results for future reference, click the “Download CSV” button. 
            This will show you all of your results from the search in a CSV that includes the issue date, 
            the page number, the keyword, and the line where the keyword was found. </li>
          </ul>
        </p>
    </ul>
  </div>
  <!-- CONTROLLED VOCABULARY CONTENT-->
  <div id="cv-content" class="tab-content">
    <h3>Wondering Where to Start?</h3>
    <p>Below is a list of important key figures, groups, and events found in Davidson's History, 
      known as the "Controlled Vocabulary." Click on a term below to begin your historical research.</p>
    <h4><strong>Controlled Vocabulary:</strong></h4>
    <p><em>"Some of the terminology used is reflective of the language used historically by members of the Davidson community. 
      These terms may be, but are not necessarily, outdated, offensive, and/or harmful. While we would not use this terminology 
      today, it is important to search for these terms in historical documents to surface valuable information for researchers 
      today." (Davidson College Archives 2024)</em></p>
      <ul id="vocab-list">
        <h5>A</h5>
        <li class="vocab-item">"George Lawrence Abernathy"</li><li class="vocab-item">"Anthony S. Abbot"</li><li class="vocab-item">"Tony Abbott"</li>
        <li class="vocab-item">Accessibility</li><li class="vocab-item">"Ada Jenkins Center"</li><li class="vocab-item">"Affordable Housing"</li>
        <li class="vocab-item">"African American"</li><li class="vocab-item">"AIDS Quilt"</li><li class="vocab-item">Alexander</li>
        <li class="vocab-item">"Alpha Kappa Alpha"</li><li class="vocab-item">"Alpha Phi Alpha"</li><li class="vocab-item">"Alpha Tau Omega"</li>
        <li class="vocab-item">Aboretum</li><li class="vocab-item">"Mary Archie"</li><li class="vocab-item">"Juanita Archie"</li>
        <li class="vocab-item">Asbestos</li><li class="vocab-item">Asian</li><li class="vocab-item">"Asian Culture and Awareness Association"</li>
        <li class="vocab-item">"Asian Studies"</li><li class="vocab-item">"Asian American"</li><li class="vocab-item">"Asian American Studies"</li>
        <li class="vocab-item extra-space">Athletics</li>
        <h5>B</h5>
        <li class="vocab-item">Barbershop</li><li class="vocab-item">Baseball</li><li class="vocab-item">"Baseball field"</li>
        <li class="vocab-item">Basketball</li><li class="vocab-item">"Beaver Dam"</li><li class="vocab-item">"Beta Theta Pi"</li>
        <li class="vocab-item">"Beauty Supply"</li><li class="vocab-item">"Bicentennial Committee"</li><li class="vocab-item">"Biddle Memorial Institute"</li>
        <li class="vocab-item">"Black Students"</li><li class="vocab-item">"Black Student Coalition"</li>
        <li class="vocab-item">"Nancy Blackwell"</li><li class="vocab-item">"Renee Denise Fanuiel Blackwell"</li><li class="vocab-item">"Boarding House"</li>
        <li class="vocab-item">Bookclub</li><li class="vocab-item">"Boone Neighborhood"</li><li class="vocab-item">"Boy Scout Troop"</li>
        <li class="vocab-item">"Brady's Alley"</li><li class="vocab-item">"Fannie Brandon"</li><li class="vocab-item">"Marvin Brandon"</li><li class="vocab-item">"Brick Row"</li>
        <li class="vocab-item">"Bridgeport Fabrics"</li><li class="vocab-item extra-space">"Leslie Brown"</li>
        <h5>C</h5>
        <li class= "vocab-item">"Bee Jay Caldwell"</li><li class="vocab-item">"Calvary Presbyterian Church"</li>
        <li class="vocab-item">"Campus Revolutionaries Implementing Progress"</li><li class="vocab-item">CRIP</li><li class="vocab-item">Carr</li>
        <li class="vocab-item">"Evelyn Carr"</li><li class="vocab-item">"Garfield Carr"</li><li class="vocab-item">"Rosa Carr"</li>
        <li class="vocab-item">"Catawba River"</li><li class="vocab-item">Cemetery</li><li class="vocab-item">"Chambers Building"</li>
        <li class="vocab-item">"Maxwell Chambers"</li><li class="vocab-item">"Christian Aid Society"</li><li class="vocab-item">Church</li>
        <li class="vocab-item">Churches</li><li class="vocab-item">"Civil Rights"</li><li class="vocab-item">Coeducation</li><li class="vocab-item">Co-eds</li>
        <li class="vocab-item">"The Coffee Cup"</li><li class="vocab-item">CoHo</li><li class="vocab-item">"Columbus Chapel"</li><li class="vocab-item">Commemoration</li>
        <li class="vocab-item">"Common Ground"</li><li class="vocab-item">"Community Development"</li><li class="vocab-item">"Community Relations Committee"</li>
        <li class="vocab-item">Confederate</li><li class="vocab-item">Conner</li><li class="vocab-item">"Cecelia Conner"</li><li class="vocab-item">Connor</li>
        <li class="vocab-item">"Connor House"</li><li class="vocab-item">Cooks</li><li class="vocab-item">"Cotton Mill"</li>
        <li class="vocab-item extra-space">"Wayne Crumwell"</li>
        <h5>D</h5>
        <li class="vocab-item">"Daughters of the American Revolution"</li><li class="vocab-item">"Chalmers Davidson"</li>
        <li class="vocab-item">"Davidson African American Coalition"</li><li class="vocab-item">"Davidson College Presbyterian Church"</li>
        <li class="vocab-item">"Davidson Colored School"</li><li class="vocab-item">"Davidson Colored Elementary"</li>
        <li class="vocab-item">"Davidson Cotton Mill"</li><li class="vocab-item">"Davidson Elementary"</li><li class="vocab-item">"Davidson Lands Conservancy"</li>
        <li class="vocab-item">"Davidson Housing Coalition"</li><li class="vocab-item">"Davidson Methodist Church"</li>
        <li class="vocab-item">"Davidson Prebyterian Church"</li><li class="vocab-item">"Delta Sigma Theta"</li><li class="vocab-item">"Desegregation"</li>
        <li class="vocab-item">Development</li><li class="vocab-item">Disability</li><li class="vocab-item">"Disability Rights"</li>
        <li class="vocab-item">Discrimination</li><li class="vocab-item">Dixie</li><li class="vocab-item">"Charles Driesell"</li><li class="vocab-item">Lefty</li>
        <li class="vocab-item">Donaldson</li><li class="vocab-item">"Enoch Donaldson"</li><li class="vocab-item">"Downtown Development Organization"</li>
        <li class="vocab-item">"Downtown Revitalization Plan"</li><li class="vocab-item">"Duke Endowment"</li><li class="vocab-item">"Duke Energy"</li>
        <li class="vocab-item extra-space">"Duke Power"</li>
        <h5>E</h5>
        <li class="vocab-item">"Eating House"</li><li class="vocab-item">"Ecological Preserve"</li><li class="vocab-item">"Bill Edwards"</li>
        <li class="vocab-item">"Elm Row"</li><li class="vocab-item">Emanon</li><li class="vocab-item">"Enviornmental Action Coalition"</li>
        <li class="vocab-item">EAC</li><li class="vocab-item">"Erwin Lodge"</li><li class="vocab-item">"Eumenean Society"</li>
        <li class="vocab-item extra-space">"Exchange Students"</li>
        <h5>F</h5>
        <li class="vocab-item">"Nancy Fairley"</li><li class="vocab-item">"Fannie and Mabel"</li><li class="vocab-item">"Farmers Market"</li>
        <li class="vocab-item">FIJI</li><li class="vocab-item">Fraternities</li><li class="vocab-item">"Friends of Lesbians and Gays"</li><li class="vocab-item">F.L.A.G</li>
        <li class="vocab-item">"Foreign Students"</li><li class="vocab-item">"Foreign Missionaries"</li><li class="vocab-item">Forney</li>
        <li class="vocab-item extra-space">"Cecelia Forney"</li>   
        <h5>G</h5> 
        <li class="vocab-item">"Gay-Straight Alliance"</li><li class="vocab-item">Gender</li><li class="vocab-item">"Gender Equity"</li>
        <li class="vocab-item">"Gender Inclusive"</li><li class="vocab-item">"Gender Neutral"</li><li class="vocab-item">"Gender Resource Center"</li>
        <li class="vocab-item">"Gender and Sexuality Studies"</li><li class="vocab-item">"General Time"</li><li class="vocab-item">"Gethsemane Baptist Church"</li>
        <li class="vocab-item">"Greek Life"</li><li class="vocab-item">"Griffith Street"</li><li class="vocab-item">"Griffith Street Properties"</li>
        <li class="vocab-item">"Grocery Store"</li><li class="vocab-item extra-space">Gunsmoke</li>
        <h5>H</h5>
        <li class="vocab-item">"Habitat for Humanity"</li><li class="vocab-item">"Janet Harrell"</li><li class="vocab-item">"Hearing Committee"</li>
        <li class="vocab-item">"Doug Hicks"</li><li class="vocab-item">Hillel</li><li class="vocab-item">Hispanic</li>
        <li class="vocab-item">"Honor Code"</li><li class="vocab-item">"Honor Council"</li><li class="vocab-item">"Horticulture Symposium"</li>
        <li class="vocab-item">Housemother</li><li class="vocab-item">Houson</li><li class="vocab-item">"Lula Bell Houston"</li>
        <li class="vocab-item">Howard</li><li class="vocab-item">"Brenda Howard"</li><li class="vocab-item">"Dovie Howard"</li>
        <li class="vocab-item">"Huntersville Colored School"</li><li class="vocab-item extra-space">"Hurricane Hugo"</li>
        <h5>I</h5>
        <li class="vocab-item">I-77</li><li class="vocab-item">Ingersoll-Rand</li><li class="vocab-item">Integration</li>
        <li class="vocab-item">"International Students"</li><li class="vocab-item extra-space">Interstate</li>
        <h5>J</h5>
        <li class="vocab-item">Janitor</li><li class="vocab-item">"Ernest Jeffries"</li><li class="vocab-item">"Jewish Student Union"</li>
        <li class="vocab-item">"Johnson C. Smith University"</li><li class="vocab-item">"Erving Elizabeth Johnson"</li>
        <li class="vocab-item">"Harry Johnson"</li><li class="vocab-item">"Lela Johnson"</li><li class="vocab-item">"Ralph Johnson"</li>
        <li class="vocab-item">"Tobe Johnson"</li><li class="vocab-item">"Walter Johnson"</li><li class="vocab-item extra-space">"July Experience"</li>
        <h5>K</h5>
        <li class="vocab-item">"Kappa Alpha"</li><li class="vocab-item">"Kappa Sigma"</li><li class="vocab-item">Kindred</li>
        <li class="vocab-item">Knox</li><li class="vocab-item extra-space">"Ku Klux Klan"</li>
        <h5>L</h5>
        <li class="vocab-item">Lake</li><li class="vocab-item">"Lake Campus"</li><li class="vocab-item">"Lake Norman"</li>
        <li class="vocab-item">"Lake Norman Company"</li><li class="vocab-item">"Lakeside Apartments"</li><li class="vocab-item">"Lakeside Park Project"</li>
        <li class="vocab-item">"Lakeside Terrace"</li><li class="vocab-item">"Lambda Pi Chi"</li><li class="vocab-item">Latino</li>
        <li class="vocab-item">Latina</li><li class="vocab-item">Latinx</li><li class="vocab-item">"Latin American Studies"</li>
        <li class="vocab-item">Laundress</li><li class="vocab-item">Laundrettes</li><li class="vocab-item">Laundry</li><li class="vocab-item">"Lavender Lounge"</li>
        <li class="vocab-item">LGBT</li><li class="vocab-item">LGBTQ</li><li class="vocab-item">LGBT+</li><li class="vocab-item">LGBTQIA</li>
        <li class="vocab-item">Linden</li><li class="vocab-item">"Linden Manufactoring Company"</li><li class="vocab-item">Lingle</li>
        <li class="vocab-item">"Zach Long"</li><li class="vocab-item">"Zachary Long"</li><li class="vocab-item">Lowery</li><li class="vocab-item">"Annie Mildred Lowery"</li>
        <li class="vocab-item">"Susan Lowery"</li><li class="vocab-item">"Susie Lowery"</li><li class="vocab-item">"Low-Income Housing"</li>
        <li class="vocab-item extra-space">"Love of Learning"</li>
        <h5>M</h5>
        <li class="vocab-item">"Caroline MacBreyer"</li><li class="vocab-item">Machis</li><li class="vocab-item">"Masonic Lounge"</li>
        <li class="vocab-item">McConnell</li><li class="vocab-item">"McConnell Neighborhood"</li> <li class="vocab-item">McKissock</li>
        <li class="vocab-item">"Warren McKissock"</li><li class="vocab-item">"Mecklenburg Declaration of Independence"</li><li class="vocab-item">"M&M Soda Shop"</li>
        <li class="vocab-item">"Mill Church"</li><li class="vocab-item">"Paula Moore Miller"</li><li class="vocab-item">Minorities</li>
        <li class="vocab-item">Minstrels</li><li class="vocab-item">Missionary</li><li class="vocab-item">Missionaries</li>
        <li class="vocab-item">"Mock Circle"</li><li class="vocab-item">"Mock Hill"</li><li class="vocab-item">Multicultural</li>
        <li class="vocab-item">"Muslim Student Association"</li><li class="vocab-item extra-space">MSA</li>
        <h5>N</h5>
        <li class="vocab-item">"NAMES Project"</li><li class="vocab-item">"National Panhellenic Council"</li><li class="vocab-item">Negro</li>
        <li class="vocab-item">"Cora Louise Nelson"</li><li class="vocab-item">Ney</li><li class="vocab-item">Norton</li>
        <li class="vocab-item">"Hood Norton"</li><li class="vocab-item">"Benoit Nzengu"</li><li class="vocab-item extra-space">"George Nzongola"</li>
        <h5>O</h5>
        <li class="vocab-item">"Oak Row"</li><li class="vocab-item">"Old South"</li><li class="vocab-item">"Omicron Delta Epsilon"</li>
        <li class="vocab-item">"Organization of Latino American Students"</li><li class="vocab-item extra-space">OLAS</li>
        <h5>P</h5>
        <li class="vocab-item">"Patterson Court"</li><li class="vocab-item">"Patterson Court Council"</li><li class="vocab-item">PCC</li>
        <li class="vocab-item">PAX</li><li class="vocab-item">"James Christian Pfohl"</li><li class="vocab-item">"Phi Beta Kappa"</li>
        <li class="vocab-item">"Phi Delta Theta"</li><li class="vocab-item">"Phi Gamma Delta"</li><li class="vocab-item">"Philanthropic Society"</li>
        <li class="vocab-item">"Piedmont Development Assoication"</li><li class="vocab-item">"Pi Kappa Alpha"</li><li class="vocab-item">"The Pines"</li>
        <li class="vocab-item">Potts</li><li class="vocab-item">"Nannie Potts"</li><li class="vocab-item">"Ron Potts"</li>
        <li class="vocab-item">Pottstown</li><li class="vocab-item">"Project 87"</li><li class="vocab-item">"Project of the Americas"</li>
        <li class="vocab-item">PRAM</li><li class="vocab-item extra-space">Protest</li>
        <h5>Q</h5>
        <li class="vocab-item">Quadrangle</li><li class="vocab-item">"Quadwranglers Wives Club"</li>
        <li class="vocab-item">"Queens College"</li><li class="vocab-item extra-space">"Carol Quillen"</li>
        <h5>R</h5>
        <li class="vocab-item">"Race Relations"</li><li class="vocab-item">Raeford</li><li class="vocab-item">"James Raeford"</li>
        <li class="vocab-item">Railroad</li><li class="vocab-item">"Red and Black Masquers"</li><li class="vocab-item">"Reeves Temple A.M.E Zion Church"</li>
        <li class="vocab-item">"Reserve Officers Training Corps"</li><li class="vocab-item">"Richardson Scholars"</li>
        <li class="vocab-item">"Georgia Ringle"</li><li class="vocab-item">Rivens</li><li class="vocab-item">"River Run"</li>
        <li class="vocab-item">"Rosenwald School"</li><li class="vocab-item">ROTC</li><li class="vocab-item">"Roosevelt Wilson Park"</li>
        <li class="vocab-item">"Royal Shakespeare Company"</li><li class="vocab-item">Rusk</li><li class="vocab-item extra-space">"Dean Rusk"</li>
        <h5>S</h5>
        <li class="vocab-item">"Sadler Square"</li><li class="vocab-item">Scouts</li><li class="vocab-item">Segregation</li><li class="vocab-item">Self-selection</li>
        <li class="vocab-item">Servants</li><li class="vocab-item">Sexuality</li><li class="vocab-item">"Cornelia Shaw"</li><li class="vocab-item">"Sigma Alpha Epsilon"</li>
        <li class="vocab-item">"Sigma Chi"</li><li class="vocab-item">"Sigma Phi Epsilon"</li><li class="vocab-item">"Maggie Smith"</li><li class="vocab-item">"Nancy Smith"</li>
        <li class="vocab-item">Smithville</li><li class="vocab-item">"Janet Stovall"</li><li class="vocab-item">"South Asian Studies"</li>
        <li class="vocab-item">Sororities</li><li class="vocab-item">"Sparrow's Nest"</li><li class="vocab-item">"Spencer House"</li><li class="vocab-item">Sports</li>
        <li class="vocab-item">"Spring Frolics"</li><li class="vocab-item">"St. Alban's Episcopal Church"</li><li class="vocab-item">"Student Government Assoication"</li>
        <li class="vocab-item">SGA</li><li class="vocab-item">"Summit Coffee"</li><li class="vocab-item extra-space">"The Swimming Hole"</li>
        <h5>T</h5>
        <li class="vocab-item">"Take Back the Night"</li><li class="vocab-item">"Brenda Tapia"</li><li class="vocab-item">"The Teen Canteen"</li>
        <li class="vocab-item">"Willian Holt Terry"</li><li class="vocab-item">"Will Terry"</li><li class="vocab-item">"Title IX"</li>
        <li class="vocab-item">Torrence</li><li class="vocab-item">"Torrence Chapel AME Zion Church"</li><li class="vocab-item">Torrence-Lytle</li>
        <li class="vocab-item">"Lee Torrence"</li><li class="vocab-item">"Mabel Torrence"</li><li class="vocab-item">"Mable Torrence"</li>
        <li class="vocab-item">"Marjeen Torrence"</li><li class="vocab-item">"Verdie Torrence"</li><li class="vocab-item">"Town Day"</li>
        <li class="vocab-item">Trees</li><li class="vocab-item">Tuition</li><li class="vocab-item extra-space">"Turner House"</li>
        <h5>U</h5>
        <li class="vocab-item">"Unity Chapel"</li><li class="vocab-item extra-space">"Unity Church"</li>
        <h5>V</h5>
        <li class="vocab-item extra-space">"Vail Commons"</li>
        <h5>W</h5>
        <li class="vocab-item">"Warner Hall"</li><li class="vocab-item">"West Davidson"</li><li class="vocab-item">WestFest</li>
        <li class="vocab-item">Westside</li><li class="vocab-item">WDAV</li><li class="vocab-item">"Theodore Roosevelt Wilson"</li>
        <li class="vocab-item">"Roosevelt Wilson"</li><li class="vocab-item">Women</li><li class="vocab-item">"Women's Concerns Committee"</li>
        <li class="vocab-item">"Women's Tennis"</li><li class="vocab-item">"Lillian Woo"</li><li class="vocab-item extra-space">Beadsie</li>
        <h5>X</h5>
        <p></p>
        <h5>Y</h5>
        <li class = "vocab-item">"Young Men's Christian Association"</li><li class = "vocab-item extra-space">YMCA</li>
        <h5>#/Symbol</h5>
        <li class="vocab-item">"4H Club"</li><li class="vocab-item extra-space">9/11</li>
      </ul>
  </div>
  <!-- ABOUT THE PROJECT CONTENT -->  
 <div id="about-content" class="tab-content">
  <!-- <img src="{{ url_for('static', filename='assets/Open.png') }}" alt="Open" class="logo-img"> -->
    <h3>About the Project</h3>
    <p>With the commencement of the 
      <a href="https://www.davidson.edu/race-slavery-and-reconciliation/commission-race-and-slavery">Commission on Race and Slavery</a>
       in 2017, Davidson College has received many requests from African American descendant 
      community members wanting to learn about their heritage dating from slavery to 
      the late twentieth century. One important source of information came from <em>The 
      Davidsonian</em>, a student publication that served as both a local and school news 
      source for many years. From important historical events to simple visitors’ 
      reports, <em>The Davidsonian</em> is often a starting point for historical researchers. 
      However, this valuable information seemed to be lost as there was no way to 
      search through the documents without manually reading every issue. To make it 
      easier for both researchers and family members seeking information about loved 
      ones, the 2024 Community Research Fellows were tasked with coming up with a 
      digital tool that could assist with historical research of Davidson College.</p>
      <p>The goal of our project is to make Davidson’s history easily accessible to all. 
        Our student, faculty, and staff team took a deep dive into Davidson College history, 
        including its connections to slavery, and how that history has shaped the community 
        around the college. In collaboration with historian Hilary Green and the Davidson 
        College archives, our team has created text files and searchable pdfs out of the 
        Davidsonian. In addition, we have built this website to enable both simple and 
        advanced searches across all the pages. Throughout this process, our team has 
        learned and applied computational techniques and tools, including image binarization, 
        OCR, generative AI assistants, APIs, and RAG, and learned about the Digital Humanities 
        field as a whole. We hope that more people will be able to gain valuable information 
        about Davidson’s history by using this website.</p>
      <p>For more information about the process, click <a href="https://www.davidson.edu">here</a> 
        to find our paper summarizing our work.</p>
    <h5>Methodology</h5>
    <p>The goals of this project were to create searchable pdfs and readable text files from the 
      Davidson scans currently housed in the Archives system. The central process in this goal was
       <strong>Optical Character Recognition</strong> (OCR). OCR refers to the process that converts 
       an image of text into a machine-readable text format. Our project's aim was to use OCR to 
       create searchable PDFs as well as a corpus of text files containing all the contents of the 
       Davidsonian. With this corpus, we would be able to create a search tool to increase the 
       accessibility of Davidson's history to researchers, families, and community members. </p>
    <p>The OCR process necessitated subprocesses before and after, known as preprocessing and 
      postprocessing. Both of these subprocesses are intended to increase the content captured and 
      the accuracy of the text in our final text files. Accuracy measurements and tests were based 
      on 5 ground truth documents, or pages of the Davidsonian that were manually typed out. 
      Our workflow is briefly explained in the following sections, however, for a 
      more in-depth explanation of our processing, please refer to 
      our <a href="https://www.davidson.edu">research paper.</a></p> 
    <h6>Pre Processing</h6>
    <p>Our preprocessing methodology required us first to classify scans according to their quality. 
      Using the in-depth data that we collected on each scan, we constructed a composite score to 
      compare across all the documents. If any document fell below a specified threshold, we deemed it a 
      low-quality scan. Because preprocessing methods are intended to eliminate the image quality errors 
      that may worsen OCR quality, we only wanted to pre-process scans we deemed as low-quality. 
      In the image above, you can see one of our most extreme examples of this binarization process 
      from a page of the January 15, 1920 Davidsonian issue. On the left you will see the original document, 
      and on the right you will see the binarized version.</p>
      <img src="{{ url_for('static', filename='assets/Composite_Score_Dist.png') }}" alt="Scan Data" class="img-fluid rounded">
    <p>Once we identified the low-quality scans, we ran each of them through a binarization process adapted from 
      the <a href="https://huggingface.co/SBB/sbb_binarization">Berlin State Library.</a> The binarization 
      process greatly increased the amount of text captured from low-quality scans in the OCR process. </p>
    <img src="{{ url_for('static', filename='assets/binarize.png') }}" alt="Binarized" class="img-fluid rounded">
    <p></p>
    <h6>OCR</h6>
    <p>The second step of our process was to run all 23,000 documents through <a href="https://github.com/tesseract-ocr/tesseract">Tesseract</a>, 
      an open-source OCR engine by Google that recognizes and extracts text from documents. 
      Through our research, we found Tesseract to be the most accessible and useful tool for our project. 
      For more information as to why we chose Tesseract, please refer to the "something" section of 
      our <a href="https://www.davidson.edu">research paper.</a> For each scan (inputted as a tif file) we produced 
      a searchable pdf and a text file. Although the text files were comprehensible and had respectable 
      levels of accuracy, there were still areas obfuscated by miscellaneous characters or errors in the text.</p>
    <img src="{{ url_for('static', filename='assets/OCRPic.png') }}" alt="OCR" class="img-fluid rounded">
    <p>See the above image for a side-by-side comparison of what 
      Tesseract produced (left) versus what should have been produced, also known as the "Ground Truth" (right). 
      To correct these errors and increase the accuracy of the text files, we began investigating methods of 
      postprocessing to refine the files produced by Tesseract.</p>
    <h6>Post Processing</h6>
    <p>To finalize our text files, we investigated ways to reduce error rates after the OCR process. We needed an automated 
    way to identify and fix spelling errors, ambiguous characters and spacing, as well as formatting mistakes. Text generative and 
    instruction-fine tuned large language models were the most promising tool that emerged from our investigaiton. We evaluated the 
    feasibility and effectiveness of both open-source models and paid tools. We were granted access to Davidson's 
    <a href="https://platform.openai.com/docs/assistants/overview">GPT 4.o</a> workspace, allowing us to explore the ways OpenAI's model 
    could serve as a post-processing tool. Weighing open-source models against OpenAI's functionality showed us that we do 
    not have the computing resources to run a large, open-source LLM of comparable efficenty to GPT on our local computers.</p>
    <p>Exploring OpenAI as a post-processing tool required extreme intentionality to prevent hallucinations from the model and increase 
    the reliability of the output. To prevent hallucinations, we crafted thoughtful prompts (instructions to our model) and tested each of 
    them against our ground-truth documents. To increase reliability, we minimized the temperature of the model, which can be explained as the 
    randomness or creativity of the model. To prevent any changes to names or historically significant fields, we also fed our controlled vocabularly
    into our model's knowledge base and instructed it to preserve those fields with special care. </p>
    <h6>Tool Building</h6>
    <p>The final product of our research was this search tool, <em>Open Davidson</em>. Our goal was to increase the accessibility to the Davidsonian’s 
      contents and guide users to the original source. Our site uses Whoosh (a fast, pure Python search engine library) 
      to search the database of over 20,000 text files for user queries. We developed algorithms to match specific lines with 
      user queries as well, allowing users to see the context around their query in each document. Additionally, we provide 
      users with links to the scanned pdf of the page, and the tif file of the entire issue for their reference. We give users 
      the ability to search complex queries using a vast supply of operators and filters as well as sorting options for the 
      search results. To assist in the management of advanced research projects, our site offers the option to save each query’s 
      results as a csv file for storage and later reference.  </p>
    <h6>Open Davidson</h6>
    <img src="{{ url_for('static', filename='assets/Open.png') }}" alt="Open" class="img-logo">
    <p>We named our project "Open Davidson" to honor several inspirations. 
      The most direct link is to OpenAI, whose tools we used for post-processing 
      all our documents. Our success also relied heavily on open source software, 
      which was essential for our pre-processing and OCR steps and freely available 
      to the public. Additionally, <em>Open</em> reflects our mission to <em>Open</em> The Davidsonian, 
      making information readily accessible to everyone.</p>
  </div>
  <!-- TEAM CONTENT -->
  <div id="team-content" class="tab-content">
    <h3>Meet the Team</h3>
    <div class="d-flex justify-content-center">
      <img src="{{ url_for('static', filename='assets/Team_Picture.jpg') }}" alt="About Us" class="img-fluid rounded">
    </div>
    <p></p>
    <p></p>
    <h5>2024 Community Research Fellows</h5>
    <p>Community-based research (CBR) is “a form of investigation in which the question to be studied arises from the needs of a group of 
      individuals, such as undocumented workers or people who are homeless; from a concern of a nonprofit organization; 
      or from the interwoven social challenges a geographic or other type of community faces (Beckman & Long, 2016, p. 1).”  
      Over the past 10 years, the Center for Civic Engagement at Davidson has played a central role in several community needs 
      assessments and facilitated community-based research projects through academic courses in partnership with faculty.  
      In 2010, the Associate Dean served on the advisory board for the Lake Norman Area Community Needs Assessment and then 
      the Center engaged students and faculty in ongoing updates to the 2010 structure in 2014 and 2018. In the summer of 2020, 
      the Center for Civic Engagement and faculty in the Data CATS program collaborated to launch the community research fellows 
      program that engages students in place-based community research. For more information on the Community Research Fellowship, and to see 
      the work of past Fellows, 
      click <a href="https://www.davidson.edu/offices-and-services/civic-engagement/community-based-learning-research/community-based-research">here.</a></p>
    <p>This year, the Community Research Fellows took a deep dive into Davidson College history, including its 
      connections to slavery, and how that history has shaped the community around the college. In collaboration 
      with historian Hilary Green and the Davidson College archives, we scraped digital assets, including the 
      Davidsonian, and built this tool that makes it easy to search, summarize and analyze them.</p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <img src="{{ url_for('static', filename='assets/hannah.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">
    <p><strong>Hannah Holmes</strong> Class of 2026<br>Hannah is an Anthropology Major, Data Science Minor from Beaumont, Texas. 
      During the academic year, she works in the Archives and actively participates in the Dionysia theater club. 
      She has greatly appreciated the interdisciplinary nature of the project and the opportunity to explore the 
      Davidsonian. Hannah is thrilled to present this tool to the community and takes immense pride in the achievements 
      of the team.</p>
    <img src="{{ url_for('static', filename='assets/kerem.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">
    <p><strong>Kerem Atas</strong> Class of 2026<br>Kerem is a Computer Science Major, Data Science Minor from Bursa, Turkey. 
      On campus, he works for Davidson Outdoors and for the Department of Mathematics and Computer Science. 
      He is interested in applying tools and methods of data science to understand contemporary socio-political issues.</p>
    <img src="{{ url_for('static', filename='assets/maryElizabeth.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">  
    <p><strong>Mary Elizabeth Shoop</strong> Class of 2026<br>Mary Elizabeth is a Political Science Major, Data Science Minor 
      from Asheville, NC. On campus, she works in the Writing Center, grades for the Computer Science Department, 
      and runs on the Cross Country and Track teams. She has experience working on congressional campaigns, in policy research, 
      and with public opinion polling.</p>
    <img src="{{ url_for('static', filename='assets/philo.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">
    <p><strong>Philo Gabra</strong> Class of 2025<br>Philo is a Computer Science Major, Data Science Minor from Cairo, Egypt. On campus, 
      he works for Davidson Technology & Innovation (T&I) as a Student Consultant and for the Department of Mathematics and 
      Computer Science as a grade. He has been an active member and secretary of the Davidson International Association (DIA).</p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <h5>Faculty</h5>
    <img src="{{ url_for('static', filename='assets/heyer.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">
    <p><strong>Dr. Laurie Heyer</strong> <em>Associate Dean for Data & Computing, Kimbrough Professor of Mathematics and Computer Science, 
      Chair of Genomics</em><br>Laurie J. Heyer is the John T. Kimbrough Professor of Mathematics and Computer Science, 
      Associate Dean for Data and Computing, and co-director of the Community Research Fellows program at Davidson College. 
      She has co-authored two biology textbooks and conducts collaborative research with students and colleagues in data science.</p>
    <img src="{{ url_for('static', filename='assets/condor.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">
    <p><strong>Dr. Aubrey Condor</strong><em>Former Assistant Professor of the Practice of Data Science</em><br>Aubrey Condor is a data scientist and 
      researcher specializing in the use of artificial intelligence for educational applications. She previously taught courses at Davidson 
      college as part of an interdisciplinary data science minor.</p>
    <img src="{{ url_for('static', filename='assets/green.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">
    <p><strong>Dr. Hilary Green</strong><em> James B. Duke Professor of Africana Studies</em><br>Hilary N. Green is the author of <em>Educational 
      Reconstruction: African American Schools in the Urban South, 1865-1890</em> (Fordham University Press, 2016) and <em>Unforgettable 
      Sacrifice: How Black Communities Remembered the Civil War</em> (Fordham University Press, 2025).</p>
    <img src="{{ url_for('static', filename='assets/reimer.png') }}" alt="About Us" class="img-fluid rounded" style="max-width: 20%; margin-left: 0%; margin-top: 0%; margin-bottom: 0%">
    <p><strong>Dr. Stacey Reimer</strong> <em>Associate Dean of Students, Director of the Center for Civic Engagement</em><br>Stacey has over 30 years 
      of experience in higher education as a practitioner and faculty member. At Davidson, she provides strategic direction, supervision and management 
      for the areas of civic engagement, leadership development, experiential learning, student activities and the college union. Immediately prior to 
      coming to Davidson, she served as a lecturer in the Higher Education graduate program at Syracuse University and was involved with the development 
      of innovative curricula around learning communities, community-based learning, and critical reflection. Each semester she teaches a seminar on high 
      impact experiential learning.</p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <h5>Special Thanks to</h5>
    <h6>Library Staff</h6>
    <ul>
    <li><p><strong>Melissa Anderson</strong> <em>Systems and Discovery Librarian</em></p></li>
    <li><p><strong>Jessica Cottle-Hart</strong> <em>Justice, Equality, and Community Archivist</em></p></li>
    <li><p><strong>Jacob Heil</strong> <em>Assistant Director of Digital Learning</em></p></li>
    <li><p><strong>Molly Kunkel</strong> <em>Digital Archivist</em></p></li>
    <li><p><strong>James Simon</strong> <em>Assistant Director of Collections & Discovery</em></p></li>
    <li><p><strong>Sara Swanson</strong> <em>Assistant Director of Archives, Special Collections, and Community</em></p></li>
    </ul>
    <h6>Davidson T&I</h6>
    <ul>
    <li><p><strong>Luke Aeschleman</strong> <em>Cloud Solutions Architect</em></p></li>
    <li><p><strong>Michael Blackmon</strong> <em>Instructional & Research Computing Systems Administrator</em></p></li>
    <li><p><strong>Kathi Brooks</strong> <em>Application Analyst, Collaborative Apps</em></p></li>
    <li><p><strong>John McCann</strong> <em>Director of User Services and Experience</em></p></li>
    </ul>
    <h6>Additional</h6>
    <ul>
    <li><p><strong>Stella Mackler</strong> (and the 100+ years of student journalism that made this project possible!) <em>Class of 2026, 
      Editor-in-Chief of the Davidsonian</em></p></li>
    <li><p><strong>Software Developers</strong> <em>Tesseract, sbb_binarization, OpenAI Assistant API</em></p></li>
    </ul>
  </div>
  <!-- Modal Structure -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imageModalLabel">Image Preview</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <img id="modalImage" src="" alt="Image" class="img-fluid">
      </div>
    </div>
  </div>
  </div>


  <script>
  
  var isDateSortedAsc = true;  // Variable to track the current sort order for date
  // This function is the user-side search call that sends the request to the server
  function performSearch(sortCriterion) {

    // Getting the query
    var query = document.getElementById('search-input').value;

    // Processing the query as ajax request
    $.ajax({
        url: '/search',
        type: 'GET',
        data: { q: query },
        success: function(data) {
          // Sorting logic based on the criterion
          if (sortCriterion === 'date') {
            if (isDateSortedAsc) {
                data.sort(function(a, b) {
                  return new Date(a.date) - new Date(b.date);  // Ascending order
                  });
              } else {
                  data.sort(function(a, b) {
                    return new Date(b.date) - new Date(a.date);  // Descending order
                  });
                }
              }
                isDateSortedAsc = !isDateSortedAsc;  // Toggle the sort order
            var resultsDiv = $('#search-results'); 
            resultsDiv.empty(); // Reseting the results each time
            resultsDiv.append('<a> Appears in ' + data.length + ' issues </a>'); // How many issues satisfy the query 
            if (data.length > 0) { // Show download csv button and sorting buttons if there are search results being shown 
                resultsDiv.append('<button id="download-csv-btn" class="btn btn-secondary" type="button" onclick="downloadCSV()">Download CSV</button>');
                resultsDiv.append('<button id="sort-by-date" class="btn btn-secondary" type="button" onclick="performSearch(\'date\')">Sort by Date</button>');
                resultsDiv.append('<button id="sort-by-score" class="btn btn-secondary" type="button" onclick="performSearch(\'score\')">Sort by Relevance</button>');
            }
            
            // The data shown for each search hit:
            data.forEach(function(item, index) {
                var collapseId = 'collapse' + index;
                var matchingLines = item.matching.map(function(match) {
                    var highlightedContext = match.context.map(function(contextLine) {
                      var regex = new RegExp(`\\b${query}\\b`, 'gi');
                        return contextLine.replace(regex, function(matched) {
                            return `<span class="highlight">${matched}</span>`;
                        });
                      }).join(' ');
                    return `
                        <div class="context">
                            <p><strong>Line ${match.line_number}:</strong><br>
                            <span class="context-text">${highlightedContext}</span></p>
                        </div>
                    `;
                }).join('');
                resultsDiv.append(`
                    <div class="card">
                        <div class="card-header" id="heading${index}">
                            <h2 class="mb-0">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#${collapseId}" aria-expanded="true" aria-controls="${collapseId}">
                                    ${item.title}
                                </button>
                                <a href="${item.pdf_url}" target="_blank" class="btn btn-link">View Page</a>
                                </button>
                                <a href="${item.url}" target="_blank" class="btn btn-link">View Issue</a>
                            </h2>
                        </div>
                        <div id="${collapseId}" class="collapse" aria-labelledby="heading${index}" data-parent="#search-results">
                            <div class="card-body">
                                ${matchingLines}
                            </div>
                        </div>
                    </div>
                `);
            });
           
            // Show the buttons after search results are displayed
            $('#download-csv-button').show();
            $('#sort-by-date').show();
            $('#sort-by-score').show();
          }
    });
}
  // Helper: formats the year input if inputted as YYYY
  function formatYearInput(value) {
    if (value.length === 4 && !isNaN(value)) {
      return `${value}-01-01`;}
    return value;
  }
  // Helper: tests if date entry is valid
  function isValidDate(value) {
    const date = new Date(value);
    return !isNaN(date.getTime());
  }
  // Main function for handling the date entries 
        // Allows users to use YYYY or MM/DD/YYYY formats for year filter in advanced search
  function handleDateInputBlur(event) {
    const input = event.target;
    const value = input.value;
    const formattedValue = formatYearInput(value);
    if (isValidDate(formattedValue)) {
        input.value = formattedValue;}
  }
  // Event listeners to call date function whenever a user clicks away from the date input bar 
  document.getElementById('date-from').addEventListener('blur', handleDateInputBlur);
  document.getElementById('date-to').addEventListener('blur', handleDateInputBlur);

  // This function is the same user-side search call and performSearch(), but with the advanced search filters
  function performAdvancedSearch(sortCriterion) {

    // Getting the query and the filters 
    var keyword = $('#keyword').val();
    var dateFrom = $('#date-from').val();
    var dateTo = $('#date-to').val();
    var contextLines = $('#context-lines').val();

    // Formatting the date inputs
    if (dateFrom && dateFrom.length === 4 && !isNaN(dateFrom)) {
        dateFrom = formatYearInput(dateFrom);}
    if (dateTo && dateTo.length === 4 && !isNaN(dateTo)) {
        dateTo = formatYearInput(dateTo);}
    // Validate the date inputs
    if (dateFrom && !isValidDate(dateFrom)) {
        alert('Invalid "Date From" input');
        return;}
    if (dateTo && !isValidDate(dateTo)) {
        alert('Invalid "Date To" input');
        return;}
    if (dateFrom && !isValidDate(dateFrom)) {
        alert('Invalid "Date From" input');
        return;}
    if (dateTo && !isValidDate(dateTo)) {
        alert('Invalid "Date To" input');
        return;}
    // Convert the date to the expected format (YYYY-MM-DD)
    if (dateFrom) {
        dateFrom = new Date(dateFrom).toISOString().split('T')[0];}
    if (dateTo) {
        dateTo = new Date(dateTo).toISOString().split('T')[0];}

    // Make the server request
    $.ajax({
        url: '/search',
        type: 'GET',
        data: {
            q: keyword,
            date_from: dateFrom,
            date_to: dateTo,
            context_lines: contextLines
        },
        success: function(data) {
            // Sorting criteria if the user presses either sort button
            if (sortCriterion === 'date') {
                data.sort(function(a, b) {
                    return new Date(a.date) - new Date(b.date);
                });
            } else if (sortCriterion === 'score') {
                data.sort(function(a, b) {
                    return b.score - a.score;
                });
            }
            var resultsDiv = $('#advanced-search-results');
            resultsDiv.empty();
            resultsDiv.append('<a> Appears in ' + data.length + ' issues </a>'); // How many issues satisfy the query?
            if (data.length > 0) { // Only show these buttons if there are search results being shown 
                resultsDiv.append('<button id="download-csv-btn" class="btn btn-secondary" type="button" onclick="downloadCSV()">Download CSV</button>');
                resultsDiv.append('<button id="sort-by-date-adv" class="btn btn-secondary" type="button" onclick="performAdvancedSearch(\'date\')">Sort by Date</button>');
                resultsDiv.append('<button id="sort-by-score-adv" class="btn btn-secondary" type="button" onclick="performAdvancedSearch(\'score\')">Sort by Relevance</button>');
            }
            data.forEach(function(item, index) { // Data shown for each search result
                var collapseId = 'collapse' + index;
                var matchingLines = item.matching.map(function(match) {
                    var highlightedContext = match.context.map(function(contextLine) {
                        var regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                        return contextLine.replace(regex, function(matched) {
                            return `<span class="highlight">${matched}</span>`;
                        });
                    }).join(' ');
                    return `
                        <div class="context">
                            <p><strong>Line ${match.line_number}:</strong></p>
                            <p class="context-text">${highlightedContext}</p>
                        </div>
                    `;
                }).join('');
                resultsDiv.append(`
                    <div class="card">
                        <div class="card-header" id="heading${index}">
                            <h2 class="mb-0">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#${collapseId}" aria-expanded="true" aria-controls="${collapseId}">
                                    ${item.title}
                                </button>
                                <a href="${item.pdf_url}" target="_blank" class="btn btn-link">View Page</a>
                                </button>
                                <a href="${item.url}" target="_blank" class="btn btn-link">View Issue</a>
                            </h2>
                        </div>
                        <div id="${collapseId}" class="collapse" aria-labelledby="heading${index}" data-parent="#advanced-search-results">
                            <div class="card-body">
                                ${matchingLines}
                            </div>
                        </div>
                    </div>
                `);
            });
        }
    });
  }

  // Server call to allow users to download csv of all their search results
  function downloadCSV() {
    // Getting the queries and the filters 
    var query = document.getElementById('search-input').value || document.getElementById('keyword').value;
    var dateFrom = document.getElementById('date-from').value;
    var dateTo = document.getElementById('date-to').value;
    var contextLines = document.getElementById('context-lines').value;

    // Downloading the csv
    var url = `/download_csv?q=${encodeURIComponent(query)}&date_from=${encodeURIComponent(dateFrom)}&date_to=${encodeURIComponent(dateTo)}&context_lines=${encodeURIComponent(contextLines)}`;
    window.location.href = url;
}

    
  $(document).ready(function() {

  $('.image-link').click(function(event) {
        event.preventDefault();
        var imageUrl = $(this).attr('href');
        $('#modalImage').attr('src', imageUrl);
        $('#imageModal').modal('show');
    });

    // Enforce the maximum value of 20 for the context lines input
    document.getElementById('context-lines').addEventListener('input', function() {
        if (this.value > 20) {
            this.value = 20;
        }
    });

    // Click event listeners for sorting buttons on default search 
    $('#sort-by-date').click(function() {
        performSearch('date');});
    $('#sort-by-score').click(function() {
        performSearch('score');});
    // Click event listeners for sorting buttons on advanced search
    $('#sort-by-date-adv').click(function() {
        performAdvancedSearch('date');});
    $('#sort-by-score-adv').click(function() {
        performAdvancedSearch('score');});

    // Click event listeners for controlled vocabulary term searches
    $('.vocab-item').click(function() {
        var term = $(this).text();
        $('#search-input').val(term);
        showTabContent('#home-content');
        performSearch();
      });

    // Refresh the page when you click home tab or archive search icon
    $('#home-link, #archive-search-icon').click(function() {
        location.reload();
    });

    // Show specific tab content
    function showTabContent(contentId) {
        $('.tab-content').hide(); // Hide all tab contents
        $(contentId).show(); // Show the selected tab content
      }

    // Event listener to the search input field to detect the "Enter" key press
    $('#search-input').on('keypress', function(e) {
        if (e.which == 13) { // Enter key corresponds to key code 13
            performSearch();}
      });
    // Event listener for "Enter" key press on advanced search function
    $('#keyword, #date-from, #date-to, #context-lines').on('keypress', function(e) {
      if (e.which == 13) { // Enter key corresponds to key code 13
          performAdvancedSearch();}
      });

      // LINKS
      $('#home-link').click(function() {
        showTabContent('#home-content');
      });
      $('#instructions-link').click(function() {
        showTabContent('#instructions-content');
      });
      $('#about-link').click(function() {
        showTabContent('#about-content');
      });
      $('#cv-link').click(function() {
        showTabContent('#cv-content');
      });
      $('#team-link').click(function() {
        showTabContent('#team-content');
      });
      $('#go-to-cv').click(function() {
        showTabContent('#cv-content');
      });
      $('#advanced-search-link').click(function() {
        showTabContent('#advanced-search-content');
      });
      $('#go-to-advanced-search').click(function() {
        showTabContent('#advanced-search-content');
        });
      $('#go-to-instructions').click(function() {
        showTabContent('#instructions-content');
        });
      
      // // Show home content by default
      showTabContent('#home-content');
    });

  </script>

  <!-- Bootstrap and jQuery scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>